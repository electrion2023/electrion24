<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Subida de Imágenes</title>
<style>
  body { font-family: Arial; background: #f2f2f2; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
  .box { background: #fff; padding: 20px; border-radius: 8px; width: 320px; box-shadow: 0 0 10px rgba(0,0,0,.1); text-align: center; }
  label { display: block; margin-top: 15px; font-weight: bold; text-align: left; }
  input, button { width: 100%; margin-top: 5px; box-sizing: border-box; }
  button { margin-top: 20px; padding: 10px; background: #28a745; color: #fff; border: none; cursor: pointer; border-radius: 5px; font-weight: bold; }
  img { margin-top: 20px; max-width: 100%; border: 1px solid #ddd; border-radius: 4px; }
  #estado { margin-top: 10px; font-size: 14px; font-weight: bold; }
</style>
</head>
<body>

<div class="box">
  <h2>Subir imágenes</h2>

  <label>Foto 1</label>
  <input type="file" id="foto1" accept="image/*">

  <label>Foto 2</label>
  <input type="file" id="foto2" accept="image/*">

  <button onclick="subir()">Subir y Reemplazar</button>
  <p id="estado"></p>

  <label>Vista previa (Foto 1):</label>
  <img id="preview" src="https://res.cloudinary.com/dxgplmbg/image/upload/imagenes/foto1.jpg">
</div>

<script>
// Tus credenciales según las capturas
const CLOUD_NAME = "dxgplmbg";
const UPLOAD_PRESET = "github_upload";

async function subir() {
  const f1 = document.getElementById("foto1").files[0];
  const f2 = document.getElementById("foto2").files[0];
  const estado = document.getElementById("estado");
  const preview = document.getElementById("preview");

  if (!f1 || !f2) {
    estado.innerText = "⚠️ Seleccioná ambos archivos";
    estado.style.color = "orange";
    return;
  }

  estado.innerText = "Subiendo... ⏳";
  estado.style.color = "black";

  try {
    // Subimos ambas enviando el nombre a través del archivo
    await enviarACloudinary(f1, "foto1");
    await enviarACloudinary(f2, "foto2");

    estado.innerText = "✅ ¡Éxito! Guardadas en carpeta 'imagenes'";
    estado.style.color = "green";

    // Actualizar vista previa (con timestamp para evitar caché)
    preview.src = `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/imagenes/foto1.jpg?v=${new Date().getTime()}`;

  } catch (e) {
    estado.innerText = "❌ " + e.message;
    estado.style.color = "red";
  }
}

async function enviarACloudinary(file, nombreFijo) {
  const url = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`;
  const formData = new FormData();

  // Renombramos el archivo aquí mismo. 
  // Tu preset usará este nombre como Public ID
  const blob = file.slice(0, file.size, file.type);
  const nuevoArchivo = new File([blob], `${nombreFijo}.jpg`, { type: 'image/jpeg' });

  formData.append("file", nuevoArchivo);
  formData.append("upload_preset", UPLOAD_PRESET);
  
  // NO agregamos API KEY ni PUBLIC_ID porque el preset es Unsigned 
  // y tiene "Disallow public id: true"

  const resp = await fetch(url, {
    method: "POST",
    body: formData
  });

  const datos = await resp.json();

  if (!resp.ok) {
    throw new Error(datos.error.message);
  }
  
  return datos;
}
</script>

</body>
</html>
